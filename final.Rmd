---
title: "Mini-Project 2"
author: "Yi Ning, Ayumi Mizuno"
date: "10/29/2017"
output: html_document
---
In this project, we are mainly exploring the `contributions` datasets to see which committees have the highest transaction amount, and which candidates benefitted from these contributions. We are especially interested in Political Action Committees (PACs), a type of organization that pool campaign contributions from members of a corporate or labor union, and donate those funds for or against campaign candidates. We are also interested in Candidate Committee (CCM), which are committes directly affiliated to the candidates to receive contributions and make expenditures on his or her behalf. PACs are powerful political entities that are known as influential financial actors behind elections, and CCMs, by definition, plays the central role in campaign finance.
Hence, we extracted relevent data from the three datasets `contributions`,`candidates` and `committes` to graph plots that show the top 20 candidates receiving contributions from the top 10 committes of either type in both primary and general election of 2012. 

```{r, include=FALSE}
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```
```{r warning= FALSE}
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(gridExtra)
```
```{r}
##getting data to be used for filtering data
candID <- candidates %>%
  select(cand_id, cand_name) 
commitID <- committees %>%
  select(cmte_id, cmte_name)
```
```{r}
# getting data for a certain type of committee for a certain type of transaction
# The function will show the contributions received by the top 20 candidates from the top 10 committes 
find_pac_data<-function(pgi,entity ="PAC",num = 20){
  #find filter contributions according to function parameters, and join with candID and commitID to obtain names
  #We filtered out transaction type 24A, which is a transaction against a candidate, so we only show financial support from a committee towards a candidate
  pac<-contributions %>%
    filter(entity_type == entity, transaction_pgi==pgi, transaction_type!= "24A") %>%
    mutate(transaction_amt = as.integer(transaction_amt)) %>% 
    select(cmte_id, transaction_amt, cand_id) %>%
    inner_join(candID, by="cand_id") %>%
    inner_join(commitID, by="cmte_id") %>%
    arrange(desc(transaction_amt)) 
#find the top 10 committees by transaction summary
top10cmte<- pac %>% 
  group_by(cmte_name) %>% 
  summarize(transactionsum = sum(transaction_amt)) %>% 
  arrange(desc(transactionsum)) %>% 
  head(10)
#find the contribution towards the top 20 candidates by these committes
topcmtecontribution<- pac %>% 
  filter(cmte_name %in% top10cmte$cmte_name) %>% 
  group_by(cand_name, cmte_name) %>% 
  summarize(transactionsum = sum(transaction_amt)) %>% 
  arrange(desc(transactionsum)) %>% 
  head(num)
#graph a bar plot on these transcations
p<-ggplot(topcmtecontribution,aes(x = reorder(cand_name, transactionsum), y = transactionsum, fill = cmte_name))+
  geom_bar(stat="identity") +
  scale_fill_discrete(name = "Committee Name")+
  scale_y_continuous(labels = scales::comma)+
  xlab("Candidates")+
  ylab("Contributions")+
  ggtitle(paste("Contributions by Top 10 ",entity,"s to Top 10 2012 Election Candidates (type:",pgi,")", sep=""))+
  theme(legend.position = "bottom")+
  coord_flip()
  
return(p)
}
```
```{r}
#run functions on PAC and CCM respectively for General and Primary elections
p<-find_pac_data("G","PAC")

p1<-find_pac_data("P","PAC")

p2<-find_pac_data("G","CCM")

p3<-find_pac_data("P","CCM")

```
```{r}
#plot 4 plots on one page
grid.arrange(p,p1,p2,p3, ncol =2)
```




Sources:
http://classic.fec.gov/finance/disclosure/metadata/DataDictionaryContributionstoCandidates.shtml 

